import { createContext, useContext, useState, useEffect, ReactNode } from "react";

type Locale = "zh" | "en";

// Translation dictionary type
type TranslationDict = {
  [key: string]: string | TranslationDict;
};

// Translations
const translations: Record<Locale, TranslationDict> = {
  en: {
    common: {
      loading: "Loading...",
      save: "Save",
      cancel: "Cancel",
      delete: "Delete",
      edit: "Edit",
      create: "Create",
      search: "Search",
      filter: "Filter",
      all: "All",
      back: "Back",
      confirm: "Confirm",
      success: "Success",
      error: "Error",
      warning: "Warning",
      info: "Info",
      noData: "No data available",
    },
    home: {
      signIn: "Sign In",
      badge: "Open Source & Community Driven",
      heroTitle1: "OpenClaw Instance",
      heroTitle2: "Management Platform",
      heroDescription: "A lightweight, elegant platform for deploying and managing your OpenClaw AI agent instances. Features instance lifecycle management, skill marketplace integration, and multi-channel support.",
      getStarted: "Get Started",
      viewOnGitHub: "View on GitHub",
      featuresTitle: "Core Features",
      featuresDescription: "Everything you need to manage your OpenClaw instances",
      feature1Title: "Instance Management",
      feature1Description: "Create, configure, start, stop and monitor OpenClaw instances with Docker containerization",
      feature2Title: "Skills Integration",
      feature2Description: "Custom skills to call external tools like Aider for coding, web scraping, data analysis and more",
      feature3Title: "Plugin System",
      feature3Description: "Extend functionality with channel integrations, deployment tools and monitoring plugins (Coming Soon)",
      learnMore: "Learn More",
      comingSoon: "Coming Soon",
      login: "Login",
      startNow: "Start Now",
      openSource: "Open Source",
      communityDriven: "Community Driven",
      instanceManagement: "Instance Management",
      platform: "Platform",
      description: "Where AI Agents come alive. Deploy once, converse anywhere—from Element to Telegram, Discord to Slack. Your agents learn new skills on the fly, backed by infrastructure that just works.",
      viewOnGithub: "View on GitHub",
      coreFeatures: "Core Features",
      instanceManagementDesc: "Create, configure, start, stop and monitor OpenClaw instances with Docker containerization",
      skillIntegration: "Skills Integration",
      skillIntegrationDesc: "Custom skills to call external tools like Aider for coding, web scraping, data analysis and more",
      pluginSystem: "Plugin System",
      pluginSystemDesc: "Extend functionality with channel integrations, deployment tools and monitoring plugins",
      aiChat: "AI Chat",
      aiChatDesc: "Chat with your OpenClaw instances in real-time, get intelligent responses and manage your AI agents interactively",
      scalable: "Scalable",
      fastDeployment: "Fast Deployment",
      readyToStart: "Ready to Get Started?",
      startBuildingToday: "Deploy your first OpenClaw instance in minutes. Open source and free forever.",
      features: "Features",
      pricing: "Pricing",
      docs: "Documentation",
      discussions: "Discussions",
      issues: "Issues",
      legal: "Legal",
      privacy: "Privacy",
      terms: "Terms",
      license: "License",
      allRightsReserved: "All rights reserved.",
      highlightsTitle: "Built for Developers",
      highlightsDescription: "OpenClaw Cloud is designed with developers in mind. Create custom skills, integrate with your favorite tools, and build powerful AI workflows.",
      feature4Title: "One-Click Deploy",
      feature4Description: "Automated Docker-based deployment with environment configuration",
      ctaTitle: "Ready to Get Started?",
      ctaDescription: "Deploy your first OpenClaw instance in minutes. Open source and free forever.",
      createAccount: "Create Your Account",
      footerText: "© 2026 OpenClaw Cloud. Open source under MIT License.",
      documentation: "Docs",
      skillsHub: "ClawHub",
      highlight1Title: "Docker-Based Deployment",
      highlight1Description: "Each instance runs in an isolated Docker container, ensuring security and easy management.",
      highlight2Title: "Multi-Provider Support",
      highlight2Description: "Support for OpenAI, Anthropic, Ollama, OpenRouter, LiteLLM and custom providers.",
      highlight3Title: "Multi-Channel Integration",
      highlight3Description: "Connect your AI agent to Telegram, Discord, Slack, Matrix and more.",
    },
    dashboard: {
      title: "Dashboard",
      welcome: "Manage your OpenClaw instances, skills and plugins from one place.",
      activeInstances: "Active Instances",
      installedPlugins: "Installed Plugins",
      availableSkills: "Available Skills",
      enabledPlugins: "Enabled Plugins",
      ofTotal: "of {total} total",
      recentInstances: "Recent Instances",
      recentInstancesDesc: "Your most recently created OpenClaw instances",
      noInstances: "No instances yet. Create your first OpenClaw instance to get started.",
      noDescription: "No description",
      quickActions: "Quick Actions",
      quickActionsDesc: "Common tasks for managing your OpenClaw platform",
      createInstance: "Create Instance",
      createInstanceDesc: "Deploy a new OpenClaw instance",
      browseSkills: "Browse Skills",
      browseSkillsDesc: "Explore skills from ClawHub",
      managePlugins: "Manage Plugins",
      managePluginsDesc: "Configure channel integrations",
    },
    instances: {
      title: "Instances",
      description: "Manage your OpenClaw instances",
      backToDashboard: "Back to Dashboard",
      createInstance: "Create Instance",
      createInstanceTitle: "Create New Instance",
      createInstanceDesc: "Deploy a new OpenClaw instance with your preferred configuration.",
      editInstance: "Edit Instance",
      editInstanceDesc: "Update your OpenClaw instance configuration.",
      basicConfig: "Basic Configuration",
      instanceName: "Instance Name",
      instanceNamePlaceholder: "My OpenClaw Instance",
      descriptionLabel: "Description",
      descriptionPlaceholder: "Optional description",
      llmConfig: "LLM Configuration",
      provider: "Provider",
      model: "Model",
      selectModel: "Select a model",
      apiKey: "API Key",
      apiKeyPlaceholder: "Your API key",
      baseUrl: "Base URL",
      baseUrlPlaceholder: "https://api.example.com/v1",
      channelConfig: "Channel Configuration",
      enableChannel: "Enable at least one channel",
      botToken: "Bot Token",
      chatId: "Chat ID",
      guildId: "Guild ID",
      channelId: "Channel ID",
      homeserverUrl: "Homeserver URL",
      accessToken: "Access Token",
      roomId: "Room ID",
      dmPolicy: "DM Policy",
      dmPolicyPairing: "Pairing (Default) - Require approval",
      dmPolicyOpen: "Open - Allow anyone",
      dmPolicyAllowlist: "Allowlist - Block unknown",
      dmPolicyDisabled: "Disabled - Ignore DMs",
      creating: "Creating...",
      updating: "Updating...",
      noInstancesYet: "No instances yet. Create your first instance to get started.",
      running: "running",
      stopped: "stopped",
      error: "error",
      start: "Start",
      stop: "Stop",
      starting: "Starting...",
      stopping: "Stopping...",
    },
    plugins: {
      title: "Plugins",
      description: "Manage channel integrations and extensions",
      backToDashboard: "Back to Dashboard",
      loadingPlugins: "Loading plugins...",
      installed: "Installed",
      enabled: "Enabled",
      version: "Version",
      by: "by",
      noPlugins: "No plugins configured yet. Plugins will appear here once instances are created with channel integrations.",
      browseMarketplace: "Browse Plugin Marketplace",
    },
    skills: {
      title: "Skills",
      description: "Browse and install skills for your OpenClaw instances",
      backToDashboard: "Back to Dashboard",
      syncSkills: "Sync Skills",
      syncing: "Syncing...",
      createSkill: "Create Skill",
      importSkills: "Import Skills",
      searchPlaceholder: "Search skills...",
      allCategories: "All Categories",
      builtIn: "Built-in",
      custom: "Custom",
      install: "Install",
      installing: "Installing...",
      selectInstance: "Select Instance",
      selectInstancePlaceholder: "Select an instance",
      noSkills: "No skills found. Try syncing skills from ClawHub.",
      createCustomSkill: "Create Custom Skill",
      createCustomSkillDesc: "Create a new custom skill with your own instructions.",
      editCustomSkill: "Edit Custom Skill",
      editCustomSkillDesc: "Update your custom skill content.",
      skillName: "Skill Name",
      skillNamePlaceholder: "my-skill",
      skillDescription: "Description",
      skillDescriptionPlaceholder: "What does this skill do?",
      category: "Category",
      skillContent: "Skill Content (Markdown)",
      skillContentPlaceholder: "Write your skill instructions in Markdown format...\n\n# Example\n\nYou are a helpful assistant that...",
      preview: "Preview",
      editor: "Editor",
      split: "Split",
      fullscreen: "Fullscreen",
      exitFullscreen: "Exit Fullscreen",
      export: "Export",
      share: "Share",
      shareSkill: "Share Skill",
      shareSkillDesc: "Share this skill with others via link or QR code.",
      copyLink: "Copy Link",
      copied: "Copied!",
      deleteSkill: "Delete Skill",
      deleteSkillConfirm: "Are you sure you want to delete",
      deleteSkillWarning: "This action cannot be undone.",
    },
    collections: {
      title: "Collections",
      description: "Organize your skills into collections",
      backToDashboard: "Back to Dashboard",
      noCollections: "No collections yet. Create your first collection to organize skills.",
      createCollection: "Create Collection",
      createCollectionTitle: "Create New Collection",
      createCollectionDesc: "Create a collection to organize related skills for batch installation.",
      collectionName: "Name",
      collectionNamePlaceholder: "Web Development Essentials",
      collectionDescription: "Description (optional)",
      collectionDescriptionPlaceholder: "Describe your collection...",
      skillCount: "{count} skill(s)",
      installAll: "Install All",
      noDescription: "No description",
    },
    nav: {
      dashboard: "Dashboard",
      chat: "AI Chat",
      instances: "Instances",
      plugins: "Plugins",
      skills: "Skills",
      collections: "Collections",
      navigation: "Navigation",
      signOut: "Sign out",
      guest: "Guest",
      notSignedIn: "Not signed in",
    },
    chat: {
      title: "AI Chat",
      subtitle: "Chat with your OpenClaw instances",
      selectInstance: "Select Instance",
      noRunningInstances: "No running instances",
      noRunningInstancesHint: "Start an instance first to begin chatting",
      selectInstanceHint: "Please select an instance to start chatting",
      selectInstanceFirst: "Select an instance first",
      welcomeTitle: "Welcome to AI Chat",
      welcomeDescription: "Select a running OpenClaw instance and start a conversation. The AI will help you with any questions.",
      inputPlaceholder: "Type your message... (Enter to send, Shift+Enter for new line)",
      thinking: "Thinking...",
      copy: "Copy",
      copied: "Copied!",
      copyFailed: "Failed to copy",
      error: "Error",
      sendFailed: "Failed to send message",
      noResponse: "No response received",
      noInstanceSelected: "No instance selected",
      disclaimer: "AI responses may not always be accurate. Please verify important information.",
      quickPrompts: {
        createInstance: "Create Instance",
        createInstancePrompt: "How do I create a new OpenClaw instance?",
        installSkill: "Install Skills",
        installSkillPrompt: "How do I install and manage skills?",
        configureChannel: "Configure Channels",
        configureChannelPrompt: "Help me configure Telegram/Discord/Slack channels",
        troubleshoot: "Troubleshoot",
        troubleshootPrompt: "My instance is not working properly, help me troubleshoot",
      },
    },
  },
  zh: {
    common: {
      loading: "加载中...",
      save: "保存",
      cancel: "取消",
      delete: "删除",
      edit: "编辑",
      create: "创建",
      search: "搜索",
      filter: "筛选",
      all: "全部",
      back: "返回",
      confirm: "确认",
      success: "成功",
      error: "错误",
      warning: "警告",
      info: "信息",
      noData: "暂无数据",
    },
    home: {
      signIn: "登录",
      badge: "开源 & 社区驱动",
      heroTitle1: "OpenClaw 实例",
      heroTitle2: "管理平台",
      heroDescription: "一个轻量、优雅的 OpenClaw AI 智能体实例部署与管理平台。支持实例生命周期管理、技能市场集成和多频道接入。",
      getStarted: "立即开始",
      viewOnGitHub: "在 GitHub 上查看",
      featuresTitle: "核心功能",
      featuresDescription: "管理 OpenClaw 实例所需的一切",
      feature1Title: "实例管理",
      feature1Description: "通过 Docker 容器化创建、配置、启动、停止和监控 OpenClaw 实例",
      feature2Title: "技能集成",
      feature2Description: "自定义技能调用外部工具，如 Aider 编程、网页抓取、数据分析等",
      feature3Title: "插件系统",
      feature3Description: "通过频道、部署工具和监控插件扩展功能（即将推出）",
      learnMore: "了解更多",
      comingSoon: "即将推出",
      login: "登录",
      startNow: "立即开始",
      openSource: "开源",
      communityDriven: "社区驱动",
      instanceManagement: "实例管理",
      platform: "平台",
      description: "赋予 OpenClaw 云端生命。一次部署，全平台对话——Web、Element无缝流转; 技能自定义热插拔，无缝对接 Opencode 等专业工具；基础设施一键就绪，配置热加载即时生效，你只管创造。",
      viewOnGithub: "在 GitHub 上查看",
      coreFeatures: "核心功能",
      instanceManagementDesc: "通过 Docker 容器化创建、配置、启动、停止和监控 OpenClaw 实例",
      skillIntegration: "技能集成",
      skillIntegrationDesc: "自定义技能调用外部工具，如 Aider 编程、网页抓取、数据分析等",
      pluginSystem: "插件系统",
      pluginSystemDesc: "通过频道、部署工具和监控插件扩展功能",
      aiChat: "AI 智能对话",
      aiChatDesc: "与您的 OpenClaw 实例实时对话，获取智能响应，交互式管理您的 AI 智能体",
      scalable: "可扩展",
      fastDeployment: "快速部署",
      readyToStart: "准备好开始了吗？",
      startBuildingToday: "几分钟内部署您的第一个 OpenClaw 实例。开源且永久免费。",
      features: "功能",
      pricing: "定价",
      docs: "文档",
      discussions: "讨论",
      issues: "问题",
      legal: "法律",
      privacy: "隐私",
      terms: "条款",
      license: "许可",
      allRightsReserved: "保留所有权利。",
      highlightsTitle: "为开发者打造",
      highlightsDescription: "OpenClaw Cloud 专为开发者设计。创建自定义技能，集成您喜爱的工具，构建强大的 AI 工作流。",
      feature4Title: "一键部署",
      feature4Description: "基于 Docker 的自动化部署，支持环境配置",
      ctaTitle: "准备好开始了吗？",
      ctaDescription: "几分钟内部署您的第一个 OpenClaw 实例。开源且永久免费。",
      createAccount: "创建账户",
      footerText: "© 2026 OpenClaw Cloud. 基于 MIT 协议开源。",
      documentation: "文档",
      skillsHub: "ClawHub",
      highlight1Title: "Docker 容器化部署",
      highlight1Description: "每个实例运行在独立的 Docker 容器中，确保安全性和便捷管理。",
      highlight2Title: "多模型提供商支持",
      highlight2Description: "支持 OpenAI、Anthropic、Ollama、OpenRouter、LiteLLM 及自定义提供商。",
      highlight3Title: "多频道集成",
      highlight3Description: "将您的 AI 智能体连接到 Telegram、Discord、Slack、Matrix 等平台。",
    },
    dashboard: {
      title: "仪表盘",
      welcome: "在一个地方管理您的 OpenClaw 实例、技能和插件。",
      activeInstances: "活跃实例",
      installedPlugins: "已安装插件",
      availableSkills: "可用技能",
      enabledPlugins: "已启用插件",
      ofTotal: "共 {total} 个",
      recentInstances: "最近实例",
      recentInstancesDesc: "您最近创建的 OpenClaw 实例",
      noInstances: "暂无实例。创建您的第一个 OpenClaw 实例以开始使用。",
      noDescription: "无描述",
      quickActions: "快捷操作",
      quickActionsDesc: "管理 OpenClaw 平台的常用操作",
      createInstance: "创建实例",
      createInstanceDesc: "部署新的 OpenClaw 实例",
      browseSkills: "浏览技能",
      browseSkillsDesc: "从 ClawHub 探索技能",
      managePlugins: "管理插件",
      managePluginsDesc: "配置频道集成",
    },
    instances: {
      title: "实例",
      description: "管理您的 OpenClaw 实例",
      backToDashboard: "返回仪表盘",
      createInstance: "创建实例",
      createInstanceTitle: "创建新实例",
      createInstanceDesc: "使用您偏好的配置部署新的 OpenClaw 实例。",
      editInstance: "编辑实例",
      editInstanceDesc: "更新您的 OpenClaw 实例配置。",
      basicConfig: "基本配置",
      instanceName: "实例名称",
      instanceNamePlaceholder: "我的 OpenClaw 实例",
      descriptionLabel: "描述",
      descriptionPlaceholder: "可选描述",
      llmConfig: "LLM 配置",
      provider: "提供商",
      model: "模型",
      selectModel: "选择一个模型",
      apiKey: "API 密钥",
      apiKeyPlaceholder: "您的 API 密钥",
      baseUrl: "Base URL",
      baseUrlPlaceholder: "https://api.example.com/v1",
      channelConfig: "频道配置",
      enableChannel: "请至少启用一个频道",
      botToken: "Bot Token",
      chatId: "Chat ID",
      guildId: "Guild ID",
      channelId: "Channel ID",
      homeserverUrl: "Homeserver URL",
      accessToken: "Access Token",
      roomId: "Room ID",
      dmPolicy: "私信策略",
      dmPolicyPairing: "配对（默认）- 需要审批",
      dmPolicyOpen: "开放 - 允许任何人",
      dmPolicyAllowlist: "白名单 - 阻止未知用户",
      dmPolicyDisabled: "禁用 - 忽略私信",
      creating: "创建中...",
      updating: "更新中...",
      noInstancesYet: "尚无实例。创建您的第一个实例以开始使用。",
      running: "运行中",
      stopped: "已停止",
      error: "错误",
      start: "启动",
      stop: "停止",
      starting: "启动中...",
      stopping: "停止中...",
    },
    plugins: {
      title: "插件",
      description: "管理频道集成和扩展",
      backToDashboard: "返回仪表盘",
      loadingPlugins: "加载插件中...",
      installed: "已安装",
      enabled: "已启用",
      version: "版本",
      by: "作者",
      noPlugins: "暂无已配置的插件。创建带有频道集成的实例后，插件将显示在这里。",
      browseMarketplace: "浏览插件市场",
    },
    skills: {
      title: "技能",
      description: "浏览并为您的 OpenClaw 实例安装技能",
      backToDashboard: "返回仪表盘",
      syncSkills: "同步技能",
      syncing: "同步中...",
      createSkill: "创建技能",
      importSkills: "导入技能",
      searchPlaceholder: "搜索技能...",
      allCategories: "全部分类",
      builtIn: "内置",
      custom: "自定义",
      install: "安装",
      installing: "安装中...",
      selectInstance: "选择实例",
      selectInstancePlaceholder: "选择一个实例",
      noSkills: "未找到技能。尝试从 ClawHub 同步技能。",
      createCustomSkill: "创建自定义技能",
      createCustomSkillDesc: "使用您自己的指令创建新的自定义技能。",
      editCustomSkill: "编辑自定义技能",
      editCustomSkillDesc: "更新您的自定义技能内容。",
      skillName: "技能名称",
      skillNamePlaceholder: "my-skill",
      skillDescription: "描述",
      skillDescriptionPlaceholder: "这个技能是做什么的？",
      category: "分类",
      skillContent: "技能内容（Markdown）",
      skillContentPlaceholder: "使用 Markdown 格式编写技能指令...\n\n# 示例\n\n你是一个有帮助的助手，能够...",
      preview: "预览",
      editor: "编辑器",
      split: "分屏",
      fullscreen: "全屏",
      exitFullscreen: "退出全屏",
      export: "导出",
      share: "分享",
      shareSkill: "分享技能",
      shareSkillDesc: "通过链接或二维码分享此技能。",
      copyLink: "复制链接",
      copied: "已复制！",
      deleteSkill: "删除技能",
      deleteSkillConfirm: "确定要删除",
      deleteSkillWarning: "此操作无法撤销。",
    },
    collections: {
      title: "收藏集",
      description: "将您的技能组织到收藏集中",
      backToDashboard: "返回仪表盘",
      noCollections: "尚无收藏集。创建您的第一个收藏集来组织技能。",
      createCollection: "创建收藏集",
      createCollectionTitle: "创建新收藏集",
      createCollectionDesc: "创建收藏集以组织相关技能，便于批量安装。",
      collectionName: "名称",
      collectionNamePlaceholder: "Web 开发必备",
      collectionDescription: "描述（可选）",
      collectionDescriptionPlaceholder: "描述您的收藏集...",
      skillCount: "{count} 个技能",
      installAll: "全部安装",
      noDescription: "无描述",
    },
    nav: {
      dashboard: "仪表盘",
      chat: "AI 对话",
      instances: "实例",
      plugins: "插件",
      skills: "技能",
      collections: "收藏集",
      navigation: "导航",
      signOut: "退出登录",
      guest: "访客",
      notSignedIn: "未登录",
    },
    chat: {
      title: "AI 对话",
      subtitle: "与您的 OpenClaw 实例对话",
      selectInstance: "选择实例",
      noRunningInstances: "无运行中的实例",
      noRunningInstancesHint: "请先启动一个实例以开始对话",
      selectInstanceHint: "请选择一个实例以开始对话",
      selectInstanceFirst: "请先选择一个实例",
      welcomeTitle: "欢迎使用 AI 对话",
      welcomeDescription: "选择一个运行中的 OpenClaw 实例并开始对话。AI 将帮助您解答任何问题。",
      inputPlaceholder: "输入消息...（Enter 发送，Shift+Enter 换行）",
      thinking: "思考中...",
      copy: "复制",
      copied: "已复制！",
      copyFailed: "复制失败",
      error: "错误",
      sendFailed: "发送消息失败",
      noResponse: "未收到响应",
      noInstanceSelected: "未选择实例",
      disclaimer: "AI 回复可能不总是准确的，请验证重要信息。",
      quickPrompts: {
        createInstance: "创建实例",
        createInstancePrompt: "如何创建新的 OpenClaw 实例？",
        installSkill: "安装技能",
        installSkillPrompt: "如何安装和管理技能？",
        configureChannel: "配置频道",
        configureChannelPrompt: "帮我配置 Telegram/Discord/Slack 频道",
        troubleshoot: "问题排查",
        troubleshootPrompt: "我的实例无法正常工作，帮我排查问题",
      },
    },
  },
};

// I18n context type
interface I18nContextType {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

// Get nested value from object using dot notation
const getNestedValue = (obj: TranslationDict, path: string): string => {
  const keys = path.split(".");
  let current: TranslationDict | string = obj;
  
  for (const key of keys) {
    if (typeof current === "string") return path;
    if (current[key] === undefined) return path;
    current = current[key];
  }
  
  return typeof current === "string" ? current : path;
};

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocale] = useState<Locale>(() => {
    const saved = localStorage.getItem("locale");
    return (saved as Locale) || "zh";
  });

  useEffect(() => {
    localStorage.setItem("locale", locale);
    document.documentElement.lang = locale;
  }, [locale]);

  const t = (key: string): string => {
    return getNestedValue(translations[locale], key);
  };

  return (
    <I18nContext.Provider value={{ locale, setLocale, t }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n must be used within an I18nProvider");
  }
  return context;
}
